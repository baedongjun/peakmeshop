<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout}">

<head>
    <title>공급사 등록/수정 - Peak Me Shop 관리자</title>
</head>

<body>
    <div layout:fragment="content">
        <!-- 페이지 헤더 시작 -->
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col">
                    <h3 class="page-title" th:text="${supplier != null ? '공급사 수정' : '공급사 등록'}">공급사 등록</h3>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/admin}">대시보드</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/admin/suppliers}">공급사 관리</a></li>
                        <li class="breadcrumb-item active" th:text="${supplier != null ? '공급사 수정' : '공급사 등록'}">공급사 등록</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- 페이지 헤더 끝 -->

        <!-- 공급사 폼 시작 -->
        <div class="card">
            <div class="card-body">
                <form th:action="${supplier != null ? '/api/admin/suppliers/' + supplier.id : '/api/admin/suppliers'}"
                      th:method="${supplier != null ? 'PUT' : 'POST'}"
                      id="supplierForm"
                      enctype="multipart/form-data">
                    
                    <!-- 기본 정보 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">공급사명</label>
                                <input type="text" class="form-control" name="name" required
                                       th:value="${supplier != null ? supplier.name : ''}"
                                       placeholder="공급사명을 입력하세요">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">공급사코드</label>
                                <input type="text" class="form-control" name="code" required
                                       th:value="${supplier != null ? supplier.code : ''}"
                                       th:readonly="${supplier != null}"
                                       placeholder="공급사코드를 입력하세요">
                                <small class="form-text text-muted">영문, 숫자 조합으로 입력하세요. (예: SUP001)</small>
                            </div>
                        </div>
                    </div>

                    <!-- 사업자 정보 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">사업자등록번호</label>
                                <input type="text" class="form-control" name="businessNumber" required
                                       th:value="${supplier != null ? supplier.businessNumber : ''}"
                                       placeholder="000-00-00000">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">대표자명</label>
                                <input type="text" class="form-control" name="representative" required
                                       th:value="${supplier != null ? supplier.representative : ''}"
                                       placeholder="대표자명을 입력하세요">
                            </div>
                        </div>
                    </div>

                    <!-- 연락처 정보 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">연락처</label>
                                <input type="tel" class="form-control" name="phone" required
                                       th:value="${supplier != null ? supplier.phone : ''}"
                                       placeholder="02-0000-0000">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>이메일</label>
                                <input type="email" class="form-control" name="email"
                                       th:value="${supplier != null ? supplier.email : ''}"
                                       placeholder="example@example.com">
                            </div>
                        </div>
                    </div>

                    <!-- 주소 정보 -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="required">우편번호</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" name="zipCode" required readonly
                                           th:value="${supplier != null ? supplier.zipCode : ''}"
                                           placeholder="우편번호">
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-secondary" onclick="searchAddress()">
                                            <i class="fas fa-search"></i> 검색
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group">
                                <label class="required">기본주소</label>
                                <input type="text" class="form-control" name="address1" required readonly
                                       th:value="${supplier != null ? supplier.address1 : ''}"
                                       placeholder="기본주소">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="required">상세주소</label>
                                <input type="text" class="form-control" name="address2" required
                                       th:value="${supplier != null ? supplier.address2 : ''}"
                                       placeholder="상세주소를 입력하세요">
                            </div>
                        </div>
                    </div>

                    <!-- 계좌 정보 -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="required">은행명</label>
                                <select class="form-control" name="bankName" required>
                                    <option value="">선택하세요</option>
                                    <option value="KB국민은행" th:selected="${supplier != null && supplier.bankName == 'KB국민은행'}">KB국민은행</option>
                                    <option value="신한은행" th:selected="${supplier != null && supplier.bankName == '신한은행'}">신한은행</option>
                                    <option value="우리은행" th:selected="${supplier != null && supplier.bankName == '우리은행'}">우리은행</option>
                                    <option value="하나은행" th:selected="${supplier != null && supplier.bankName == '하나은행'}">하나은행</option>
                                    <option value="기업은행" th:selected="${supplier != null && supplier.bankName == '기업은행'}">기업은행</option>
                                    <option value="농협은행" th:selected="${supplier != null && supplier.bankName == '농협은행'}">농협은행</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="required">계좌번호</label>
                                <input type="text" class="form-control" name="accountNumber" required
                                       th:value="${supplier != null ? supplier.accountNumber : ''}"
                                       placeholder="'-' 없이 입력하세요">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="required">예금주</label>
                                <input type="text" class="form-control" name="accountHolder" required
                                       th:value="${supplier != null ? supplier.accountHolder : ''}"
                                       placeholder="예금주명을 입력하세요">
                            </div>
                        </div>
                    </div>

                    <!-- 추가 정보 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>웹사이트</label>
                                <input type="url" class="form-control" name="website"
                                       th:value="${supplier != null ? supplier.website : ''}"
                                       placeholder="https://example.com">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>상태</label>
                                <select class="form-control" name="status">
                                    <option value="ACTIVE" th:selected="${supplier != null && supplier.status == 'ACTIVE'}">활성</option>
                                    <option value="INACTIVE" th:selected="${supplier != null && supplier.status == 'INACTIVE'}">비활성</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>메모</label>
                        <textarea class="form-control" name="memo" rows="4"
                                  th:text="${supplier != null ? supplier.memo : ''}"
                                  placeholder="공급사에 대한 메모를 입력하세요"></textarea>
                    </div>

                    <div class="text-right mt-3">
                        <a th:href="@{/admin/suppliers}" class="btn btn-secondary">취소</a>
                        <button type="submit" class="btn btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- 공급사 폼 끝 -->
    </div>

    <!-- 공급사 폼 스크립트 -->
    <th:block layout:fragment="script">
        <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
        <script th:inline="javascript">
            // 주소 검색
            function searchAddress() {
                new daum.Postcode({
                    oncomplete: function(data) {
                        document.querySelector('input[name="zipCode"]').value = data.zonecode;
                        document.querySelector('input[name="address1"]').value = data.address;
                        document.querySelector('input[name="address2"]').focus();
                    }
                }).open();
            }

            // 폼 제출 처리
            document.getElementById('supplierForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);

                fetch(this.action, {
                    method: this.method,
                    body: formData
                }).then(response => {
                    if (response.ok) {
                        window.location.href = '/admin/suppliers';
                    } else {
                        throw new Error('공급사 저장에 실패했습니다.');
                    }
                }).catch(error => {
                    console.error('Error:', error);
                    alert(error.message);
                });
            });
        </script>
    </th:block>
</body>
</html> 